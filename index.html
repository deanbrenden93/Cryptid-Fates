<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Cryptid Fates</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css?v=20">
    <link rel="stylesheet" href="progression-styles.css?v=20">
</head>
<body>
    <!-- Old fullscreen prompt - replaced by main menu -->
    <div id="fullscreen-prompt" class="hidden"></div>

    <div id="game-container" style="display: none;">
        <div id="hud">
            <div class="player-info player">
                <span class="player-name">Seeker</span>
                <div class="pyre-display">
                    <div class="pyre-icon"></div>
                    <span class="pyre-count" id="player-pyre">0</span>
                </div>
                <div class="death-counter" id="player-deaths-counter" title="Cryptids lost">
                    <span class="skull-icon">‚ò†</span>
                    <span id="player-deaths">0</span>/10
                </div>
            </div>
            <div class="player-info enemy">
                <span class="player-name">Warden</span>
                <div class="pyre-display">
                    <div class="pyre-icon"></div>
                    <span class="pyre-count" id="enemy-pyre">0</span>
                </div>
                <div class="death-counter" id="enemy-deaths-counter" title="Enemy cryptids lost">
                    <span class="skull-icon">‚ò†</span>
                    <span id="enemy-deaths">0</span>/10
                </div>
            </div>
        </div>

        <!-- Combat/Enemy turn phase overlay - covers battlefield + background but not hand/HUD -->
        <div id="combat-phase-overlay"></div>
        
        <!-- Game Screen Wrapper - contains all elements that should shake/zoom together -->
        <div id="game-screen-wrapper">
            <!-- Battlefield Background Layers - inside wrapper so they zoom/shake with content -->
            <div class="battlefield-bg-default" id="battlefield-bg-default"></div>
            <div class="battlefield-bg-player" id="battlefield-bg-player"></div>
            <div class="battlefield-bg-enemy" id="battlefield-bg-enemy"></div>
            
            <div id="phase-header">
                <span id="phase-text">Your Turn</span>
                <div id="hint">Drag cards or tap to select</div>
                <div id="resource-counters">
                    <div class="resource-item" id="deck-counter" title="Cards in deck">
                        <span class="resource-icon">üìú</span>
                        <span id="deck-count">0</span>
                    </div>
                    <div class="resource-item burn" id="burn-counter" title="Cryptids burned">
                        <span class="resource-icon">üî•</span>
                        <span id="burn-count">0</span>
                    </div>
                    <div class="resource-item" id="discard-counter" title="Discarded spells">
                        <span class="resource-icon">üìÅ</span>
                        <span id="discard-count">0</span>
                    </div>
                    <div class="resource-divider">|</div>
                    <div class="resource-item enemy" title="Enemy deck">
                        <span class="resource-icon">üìú</span>
                        <span id="enemy-deck-count">0</span>
                    </div>
                    <div class="resource-item enemy burn" title="Enemy burned">
                        <span class="resource-icon">üî•</span>
                        <span id="enemy-burn-count">0</span>
                    </div>
                    <div class="resource-item enemy" title="Enemy discarded">
                        <span class="resource-icon">üìÅ</span>
                        <span id="enemy-discard-count">0</span>
                    </div>
                </div>
            </div>

            <div id="battlefield-area">
            <div id="grid-wrapper">
                <div class="battle-grid" id="battle-grid">
                    <div class="grid-column trap-column" id="player-trap-col">
                        <div class="tile player trap" data-col="trap" data-row="0" data-owner="player">
                            <div class="tile-base"></div>
                            <span class="tile-label">Trap</span>
                        </div>
                        <div class="tile player trap" data-col="trap" data-row="1" data-owner="player">
                            <div class="tile-base"></div>
                        </div>
                    </div>
                    <div class="grid-column" id="player-support-col">
                        <div class="tile player support" data-col="0" data-row="0" data-owner="player">
                            <div class="tile-base"></div>
                            <span class="tile-label">Ward</span>
                        </div>
                        <div class="tile player support" data-col="0" data-row="1" data-owner="player">
                            <div class="tile-base"></div>
                        </div>
                        <div class="tile player support" data-col="0" data-row="2" data-owner="player">
                            <div class="tile-base"></div>
                        </div>
                    </div>
                    <div class="grid-column" id="player-combat-col">
                        <div class="tile player combat" data-col="1" data-row="0" data-owner="player">
                            <div class="tile-base"></div>
                            <span class="tile-label">Rite</span>
                        </div>
                        <div class="tile player combat" data-col="1" data-row="1" data-owner="player">
                            <div class="tile-base"></div>
                        </div>
                        <div class="tile player combat" data-col="1" data-row="2" data-owner="player">
                            <div class="tile-base"></div>
                        </div>
                    </div>
                    <div class="grid-divider">
                        <div class="divider-line"></div>
                    </div>
                    <div class="grid-column" id="enemy-combat-col">
                        <div class="tile enemy combat" data-col="0" data-row="0" data-owner="enemy">
                            <div class="tile-base"></div>
                            <span class="tile-label">Rite</span>
                        </div>
                        <div class="tile enemy combat" data-col="0" data-row="1" data-owner="enemy">
                            <div class="tile-base"></div>
                        </div>
                        <div class="tile enemy combat" data-col="0" data-row="2" data-owner="enemy">
                            <div class="tile-base"></div>
                        </div>
                    </div>
                    <div class="grid-column" id="enemy-support-col">
                        <div class="tile enemy support" data-col="1" data-row="0" data-owner="enemy">
                            <div class="tile-base"></div>
                            <span class="tile-label">Ward</span>
                        </div>
                        <div class="tile enemy support" data-col="1" data-row="1" data-owner="enemy">
                            <div class="tile-base"></div>
                        </div>
                        <div class="tile enemy support" data-col="1" data-row="2" data-owner="enemy">
                            <div class="tile-base"></div>
                        </div>
                    </div>
                    <div class="grid-column trap-column" id="enemy-trap-col">
                        <div class="tile enemy trap" data-col="trap" data-row="0" data-owner="enemy">
                            <div class="tile-base"></div>
                            <span class="tile-label">Trap</span>
                        </div>
                        <div class="tile enemy trap" data-col="trap" data-row="1" data-owner="enemy">
                            <div class="tile-base"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="sprite-layer"></div>
        </div>

        <!-- ==================== HAND AREA (Bottom 30% of screen) ==================== -->
        <div id="hand-area">
            <!-- Main Content: Left Button + Card Area + Right Button -->
            <div class="hand-main-content">
                <!-- Left menu button (large, opens action panel) -->
                <button class="hand-side-btn hand-menu-btn" id="hand-menu-btn" title="Actions Menu"></button>
                
                <!-- Card area with info bar above -->
                <div class="hand-cards-area">
                    <!-- Info bar: Phase Timeline + Card Count -->
                    <div class="hand-info-bar">
                        <div class="phase-timeline">
                            <div class="phase-node" data-phase="draw">Draw</div>
                            <div class="phase-connector"></div>
                            <div class="phase-node" data-phase="conjure1">Conjure I</div>
                            <div class="phase-connector"></div>
                            <div class="phase-node" data-phase="combat">Combat</div>
                            <div class="phase-connector"></div>
                            <div class="phase-node" data-phase="conjure2">Conjure II</div>
                            <div class="phase-connector"></div>
                            <div class="phase-node" data-phase="end">End</div>
                        </div>
                        <div class="hand-card-count" id="hand-card-count">0 Cards</div>
                    </div>
                    
                    <!-- Card scroll area (uses CSS mask-image for edge feathering) -->
                    <div class="hand-scroll-wrapper">
                        <div id="hand-container"></div>
                    </div>
                </div>
                
                <!-- Right phase button (large, advance phase) -->
                <button class="hand-side-btn advance-phase-btn" id="advance-phase-btn" title="Advance Phase"></button>
            </div>
            
            <!-- Ritual Circle Radial Menu -->
            <div class="ritual-circle-overlay" id="ritual-circle-overlay">
                <div class="ritual-circle-container">
                    <!-- Outer arcane ring -->
                    <svg class="ritual-ring outer-ring" viewBox="0 0 300 300">
                        <defs>
                            <linearGradient id="arcane-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#e8a93e;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#ff6b35;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#e8a93e;stop-opacity:1" />
                            </linearGradient>
                            <filter id="glow">
                                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                                <feMerge>
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                        <circle class="ring-path" cx="150" cy="150" r="140" fill="none" stroke="url(#arcane-gradient)" stroke-width="2" filter="url(#glow)"/>
                        <circle class="ring-path inner" cx="150" cy="150" r="120" fill="none" stroke="url(#arcane-gradient)" stroke-width="1" opacity="0.6"/>
                        <!-- Arcane runes around the circle -->
                        <text class="arcane-runes" x="150" y="150" text-anchor="middle">
                            <textPath href="#rune-path">‚òΩ ‚úß üúÇ ‚ú¶ ‚òæ ‚ÅÇ ‚óà ‚úß üúÑ ‚óÜ ‚òΩ ‚úß</textPath>
                        </text>
                        <path id="rune-path" d="M 150,20 A 130,130 0 1,1 149.9,20" fill="none"/>
                    </svg>
                    
                    <!-- Inner mystic circle -->
                    <svg class="ritual-ring inner-ring" viewBox="0 0 200 200">
                        <circle class="ring-path" cx="100" cy="100" r="60" fill="none" stroke="#e8a93e" stroke-width="1.5" opacity="0.4"/>
                        <circle class="pulse-ring" cx="100" cy="100" r="40" fill="none" stroke="#ff6b35" stroke-width="1" opacity="0.3"/>
                    </svg>
                    
                    <!-- Central sigil -->
                    <div class="central-sigil">
                        <span class="sigil-icon">üúÇ</span>
                    </div>
                    
                    <!-- Orbital action sigils -->
                    <button class="orbital-sigil sigil-kindling" id="menu-kindling-btn" title="Toggle Kindling/Grimoire" data-action="kindling">
                        <div class="sigil-glow"></div>
                        <div class="sigil-content">
                            <div class="sigil-symbol"></div>
                            <span class="sigil-label">Kindling</span>
                        </div>
                    </button>
                    
                    <button class="orbital-sigil sigil-burn" id="menu-burn-btn" title="Burn Card for Pyre" data-action="burn">
                        <div class="sigil-glow"></div>
                        <div class="sigil-content">
                            <div class="sigil-symbol"></div>
                            <span class="sigil-label">Pyre Burn</span>
                        </div>
                    </button>
                    
                    <button class="orbital-sigil sigil-end" id="menu-end-btn" title="End Turn" data-action="end">
                        <div class="sigil-glow"></div>
                        <div class="sigil-content">
                            <div class="sigil-symbol"></div>
                            <span class="sigil-label">End Turn</span>
                        </div>
                    </button>
                    
                    <!-- Floating ember particles -->
                    <div class="ember-particles">
                        <span class="ember"></span>
                        <span class="ember"></span>
                        <span class="ember"></span>
                        <span class="ember"></span>
                        <span class="ember"></span>
                        <span class="ember"></span>
                        <span class="ember"></span>
                        <span class="ember"></span>
                    </div>
                </div>
            </div>
            
            <!-- Hidden elements for backwards compatibility -->
            <div style="display:none;">
                <button id="kindling-toggle-btn"></button>
                <button id="pyre-burn-btn"></button>
                <button id="end-turn-btn"></button>
            </div>
            <div id="action-bar" style="display:none;">
                <button id="end-conjure1-btn"></button>
                <button id="end-combat-btn"></button>
            </div>
        </div>
        </div><!-- End #game-screen-wrapper -->

        <button id="cancel-target">‚úï</button>
        <div id="pyre-burn-overlay"></div>
        <div id="pyre-burn-text">üúÇ PYRE BURN üúÇ</div>

        <div id="message-overlay">
            <div id="message-text"></div>
        </div>

        <div id="status-tooltip"></div>

        <div id="game-over">
            <h1 id="game-over-text">VICTORY</h1>
            <p id="game-over-sub"></p>
            <button onclick="initGame()">Begin Anew</button>
        </div>

        <div id="tooltip">
            <h4 id="tooltip-name"></h4>
            <p id="tooltip-desc"></p>
            <p class="combat-ability" id="tooltip-combat"></p>
            <p class="support-ability" id="tooltip-support"></p>
            <p class="other-ability" id="tooltip-other" style="display: none;"></p>
            <p class="evolution-info" id="tooltip-evolution"></p>
            <button id="tooltip-sacrifice-btn" class="sacrifice-btn" style="display: none;">‚ö∞ Sacrifice Combatant</button>
            <button id="tooltip-bloodpact-btn" class="bloodpact-btn" style="display: none;">ü©∏ Blood Pact (1 dmg ‚Üí 1 pyre)</button>
            <button id="tooltip-thermal-btn" class="thermal-btn" style="display: none;">ü¶Ö Thermal Swap (heal both 2)</button>
            <button id="tooltip-rageheal-btn" class="rageheal-btn" style="display: none;">üí™ Trade 1 ATK ‚Üí Heal 2 HP</button>
            <button id="tooltip-bloodfrenzy-btn" class="bloodfrenzy-btn" style="display: none;">üê∫ Blood Frenzy (+4 ATK, die end of turn)</button>
            <button id="tooltip-decayrat-btn" class="decayrat-btn" style="display: none;">ü¶† Decay: Target ailmented enemy</button>
        </div>

        <!-- Event History Log -->
        <div id="event-log" class="collapsed">
            <div id="event-log-header">
                <span class="log-title">‚ü° Chronicle</span>
                <span class="log-title-mobile">i</span>
                <button id="event-log-toggle" title="Expand/Collapse">‚ñº</button>
            </div>
            <div id="event-log-entries"></div>
        </div>
    </div>

    <!-- Asset Preloader (load first for caching) -->
    <script src="asset-preloader.js"></script>
    
    <!-- Transition Engine -->
    <script src="transition-engine.js"></script>
    
    <!-- Game Flow (simplified for offline) -->
    <script src="login-screen.js"></script>
    
    <!-- Declarative Effect System -->
    <script src="effect-schema.js?v=2"></script>
    <script src="effect-animations.js?v=3"></script>
    <script src="effect-engine.js?v=6"></script>
    
    <!-- Card Series -->
    <script src="city-of-flesh.js?v=4"></script>
    <script src="forests-of-fear.js"></script>
    <script src="abhorrent-armory.js"></script>
    <script src="putrid-swamp.js"></script>
    
    <!-- Core Game Systems -->
    <script src="combat-effects.js?v=3"></script>
    <script src="game-core.js?v=6"></script>
    <script src="game-ui.js?v=5"></script>
    <script src="ai.js?v=2"></script>
    <script src="progression.js"></script>
    <script src="deckbuilder.js"></script>
    <script src="collection.js"></script>
    <script src="shop.js"></script>
    <script src="win-screen.js"></script>
    <script src="tutorial.js"></script>
    <script src="abyss-mode.js?v=11"></script>
    <script src="home-screen.js"></script>
    <script src="main-menu.js"></script>
    <script src="cheat-mode.js"></script>
    <script src="card-detail.js"></script>
    <script src="adventure-mode.js?v=10"></script>
    
    <!-- Multiplayer System -->
    <script src="multiplayer/client/MultiplayerClient.js"></script>
    <script src="multiplayer/multiplayer-integration.js"></script>
    
    <script>
        // Verify adventure-mode.js loaded
        console.log('[Loader Check] After adventure-mode.js - AdventureUI defined:', typeof AdventureUI !== 'undefined');
        console.log('[Loader Check] After adventure-mode.js - AdventureState defined:', typeof AdventureState !== 'undefined');
        if (typeof AdventureUI === 'undefined') {
            console.error('[Loader Check] CRITICAL: adventure-mode.js failed to define AdventureUI!');
        }
        
        // Verify abyss-mode.js loaded
        console.log('[Loader Check] After abyss-mode.js - AbyssUI defined:', typeof AbyssUI !== 'undefined');
        console.log('[Loader Check] After abyss-mode.js - AbyssEngine defined:', typeof AbyssEngine !== 'undefined');
        console.log('[Loader Check] After abyss-mode.js - AbyssState defined:', typeof AbyssState !== 'undefined');
        if (typeof AbyssUI === 'undefined') {
            console.error('[Loader Check] CRITICAL: abyss-mode.js failed to define AbyssUI!');
        }
    </script>
    
    <!-- Initialize game flow on page load -->
    <script>
        // Start the game flow (handles auth, username, tutorial, then game)
        document.addEventListener('DOMContentLoaded', () => {
            GameFlow.start();
        });
    </script>
</body>
</html>